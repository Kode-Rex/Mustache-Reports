"use strict";
var profile=(profile?profile:(function(){return require("/home/edgar/.local/lib/node_modules/profi-stanbul/profile.js");})());
var DocUtils=require('./doc-utils');var parser={postparse:function postparse(parsed,modules){var _p=profile.start('postparse',__filename,arguments);try{function getTraits(traitName,parsed){var _p=profile.start('getTraits',__filename,arguments);try{return modules.map(function(module){return module.getTraits(traitName,parsed);});}finally{profile.end(_p);}}function postparse(parsed){var _p=profile.start('postparse',__filename,arguments);try{return modules.reduce(function(parsed,module){return module.postparse(parsed,{postparse:postparse,getTraits:getTraits});},parsed);}finally{profile.end(_p);}}return postparse(parsed);}finally{profile.end(_p);}},parse:function parse(lexed,modules){var _p=profile.start('parse',__filename,arguments);try{function moduleParse(placeHolderContent,parsed){var _p=profile.start('moduleParse',__filename,arguments);try{var moduleParsed=void 0;for(var i=0,l=modules.length;i<l;i++){var _module=modules[i];moduleParsed=_module.parse(placeHolderContent);if(moduleParsed){parsed.push(moduleParsed);return moduleParsed;}}return null;}finally{profile.end(_p);}}var inPlaceHolder=false;var placeHolderContent=void 0;var tailParts=[];return lexed.reduce(function(parsed,token){if(token.type==='delimiter'){inPlaceHolder=token.position==='start';if(token.position==='end'){placeHolderContent=DocUtils.wordToUtf8(placeHolderContent);if(!moduleParse(placeHolderContent,parsed)){parsed.push({type:'placeholder',value:placeHolderContent});}Array.prototype.push.apply(parsed,tailParts);tailParts=[];return parsed;}placeHolderContent='';return parsed;}if(inPlaceHolder){if(token.type==='content'&&token.position==='insidetag'){placeHolderContent+=token.value;}else{tailParts.push(token);}return parsed;}parsed.push(token);return parsed;},[]);}finally{profile.end(_p);}}};module.exports=parser;
