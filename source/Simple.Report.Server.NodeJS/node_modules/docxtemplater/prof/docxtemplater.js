"use strict";
var profile=(profile?profile:(function(){return require("/home/edgar/.local/lib/node_modules/profi-stanbul/profile.js");})());
var _createClass=function(){function defineProperties(target,props){var _p=profile.start('defineProperties',__filename,arguments);try{for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}finally{profile.end(_p);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){var _p=profile.start('_classCallCheck',__filename,arguments);try{if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}finally{profile.end(_p);}}var DocUtils=require('./doc-utils');DocUtils.traits=require('./traits');DocUtils.moduleWrapper=require('./module-wrapper');var wrapper=DocUtils.moduleWrapper;var Docxtemplater=function(){function Docxtemplater(){var _p=profile.start('Docxtemplater',__filename,arguments);try{_classCallCheck(this,Docxtemplater);if(arguments.length>0){throw new Error('The constructor with parameters have been removed in docxtemplater 3.0, please check the upgrade guide.');}this.compiled={};this.modules=[];this.setOptions({});}finally{profile.end(_p);}}_createClass(Docxtemplater,[{key:'attachModule',value:function attachModule(module){var _p=profile.start('attachModule',__filename,arguments);try{this.modules.push(wrapper(module));return this;}finally{profile.end(_p);}}},{key:'setOptions',value:function setOptions(options){var _p=profile.start('setOptions',__filename,arguments);try{var _this=this;this.options=options;Object.keys(DocUtils.defaults).forEach(function(key){var defaultValue=DocUtils.defaults[key];_this[key]=_this.options[key]!=null?_this.options[key]:defaultValue;});if(this.zip){this.updateFileTypeConfig();}return this;}finally{profile.end(_p);}}},{key:'loadZip',value:function loadZip(zip){var _p=profile.start('loadZip',__filename,arguments);try{if(zip.loadAsync){throw new Error('Docxtemplater doesn\'t handle JSZip version >=3, see changelog');}this.zip=zip;this.updateFileTypeConfig();return this;}finally{profile.end(_p);}}},{key:'compileFile',value:function compileFile(fileName){var _p=profile.start('compileFile',__filename,arguments);try{var currentFile=this.createTemplateClass(fileName);currentFile.parse();this.compiled[fileName]=currentFile;}finally{profile.end(_p);}}},{key:'compile',value:function compile(){var _p=profile.start('compile',__filename,arguments);try{this.templatedFiles=this.fileTypeConfig.getTemplatedFiles(this.zip);return this;}finally{profile.end(_p);}}},{key:'updateFileTypeConfig',value:function updateFileTypeConfig(){var _p=profile.start('updateFileTypeConfig',__filename,arguments);try{this.fileType=this.zip.files['word/document.xml']?'docx':'pptx';this.fileTypeConfig=this.options.fileTypeConfig||Docxtemplater.FileTypeConfig[this.fileType];return this;}finally{profile.end(_p);}}},{key:'render',value:function render(){var _p=profile.start('render',__filename,arguments);try{var _this2=this;this.options.xmlFileNames=[];this.modules=this.fileTypeConfig.baseModules.map(function(moduleFunction){return moduleFunction();}).concat(this.modules);this.options=this.modules.reduce(function(options,module){return module.optionsTransformer(options,_this2);},this.options);this.xmlDocuments=this.options.xmlFileNames.reduce(function(xmlDocuments,fileName){var content=_this2.zip.files[fileName].asText();xmlDocuments[fileName]=DocUtils.str2xml(content);return xmlDocuments;},{});this.modules.forEach(function(module){module.set({zip:_this2.zip,xmlDocuments:_this2.xmlDocuments,data:_this2.data});});this.compile();this.modules.forEach(function(module){module.set({compiled:_this2.compiled});});// Loop inside all templatedFiles (ie xml files with content).
// Sometimes they don't exist (footer.xml for example)
this.templatedFiles.forEach(function(fileName){if(_this2.zip.files[fileName]!=null){_this2.compileFile(fileName);}});this.mapper=this.modules.reduce(function(value,module){return module.getRenderedMap(value);},{});Object.keys(this.mapper).forEach(function(to){var mapped=_this2.mapper[to];var from=mapped.from;var currentFile=_this2.compiled[from];currentFile.setTags(mapped.data);currentFile.render();_this2.zip.file(to,currentFile.content);});Object.keys(this.xmlDocuments).forEach(function(fileName){_this2.zip.remove(fileName);var content=DocUtils.encodeUtf8(DocUtils.xml2str(_this2.xmlDocuments[fileName]));return _this2.zip.file(fileName,content,{});});return this;}finally{profile.end(_p);}}},{key:'setData',value:function setData(data){var _p=profile.start('setData',__filename,arguments);try{this.data=data;return this;}finally{profile.end(_p);}}},{key:'getZip',value:function getZip(){var _p=profile.start('getZip',__filename,arguments);try{return this.zip;}finally{profile.end(_p);}}},{key:'createTemplateClass',value:function createTemplateClass(path){var _p=profile.start('createTemplateClass',__filename,arguments);try{var usedData=this.zip.files[path].asText();return this.createTemplateClassFromContent(usedData,path);}finally{profile.end(_p);}}},{key:'createTemplateClassFromContent',value:function createTemplateClassFromContent(content,filePath){var _p=profile.start('createTemplateClassFromContent',__filename,arguments);try{var _this3=this;var xmltOptions={filePath:filePath};Object.keys(DocUtils.defaults).forEach(function(key){xmltOptions[key]=_this3[key];});xmltOptions.fileTypeConfig=this.fileTypeConfig;xmltOptions.modules=this.modules;return new Docxtemplater.XmlTemplater(content,xmltOptions);}finally{profile.end(_p);}}},{key:'getFullText',value:function getFullText(path){var _p=profile.start('getFullText',__filename,arguments);try{return this.createTemplateClass(path||this.fileTypeConfig.textPath).getFullText();}finally{profile.end(_p);}}},{key:'getTemplatedFiles',value:function getTemplatedFiles(){var _p=profile.start('getTemplatedFiles',__filename,arguments);try{this.compile();return this.templatedFiles;}finally{profile.end(_p);}}}]);return Docxtemplater;}();Docxtemplater.DocUtils=require('./doc-utils');Docxtemplater.Errors=require('./errors');Docxtemplater.XmlTemplater=require('./xml-templater');Docxtemplater.FileTypeConfig=require('./file-type-config');Docxtemplater.XmlMatcher=require('./xml-matcher');module.exports=Docxtemplater;
